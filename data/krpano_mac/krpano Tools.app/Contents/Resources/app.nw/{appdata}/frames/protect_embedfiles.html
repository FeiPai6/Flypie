<!DOCTYPE html><html><head><title>krpano Protect Tool - Embed Files</title><link rel="stylesheet" href="../design/style.css"><link rel="stylesheet" href="../design/gui_listbox.css"><style>body{padding:0;margin:0;-webkit-user-select:none;cursor:default;background:#fff}h2{pointer-events:none;margin-top:0}table,td{text-align:left}</style></head><body><div style="position:absolute;width:100%;height:100%;display:table" onselectstart="return false" data-modaldragging="true"><div style="display:table-row; height:0; xbackground-color:green; pointer-events:none"><h2 style="margin:20px 0px 0px 20px">Embed files into the Flash swf file</h2></div><div style="display:table-row; height:0; xbackground-color:#FF33FF; pointer-events:none"><div style="color:#336699;margin:10px 20px">Add files that should be embedded into the output Flash swf file. When a xml file will be selected as 'startup xml' file, the external startup xml file will be ignored. The embedding of streaming files like video or audio files is not possible.</div></div><div style="display:table-row; height:auto; xbackground-color:#77FFFF"><table style="font-size:inherit;height:100%;padding:0;margin:0 20px" cellspacing="0"><tr style="height:100%"><td style="width:100%;margin:0;padding:0;vertical-align:top"><table style="font-size:inherit;margin:0;padding:0;width:100%;height:100%" cellspacing="0"><tr style="height:100%"><td style="margin:0;padding:0"><div id="m_embfiles" style="padding:0; margin:0; width:100%; height:100%"></div></td></tr><tr><td style="margin:0;padding:0"><div style="padding-top:4px"><table style="font-size:inherit;width:100%;padding:0;margin:0" cellspacing="0"><tr><td style="padding-right:4px;white-space:nowrap">Base&nbsp;Path:</td><td style="width:100%"><input id="m_basepath" style="vertical-align:middle;width:100%" type="text" readonly="readonly" value=""></td><td style="padding-left:4px"><button onclick="on_browse_basepath()">Browse</button></td><td style="padding-left:10px"><span id="m_totalinfo" style="white-space:nowrap;display:block;min-width:80px;text-align:right">0 Files - 0 kB</span></td></tr></table><span style="white-space:nowrap"><input id="m_autosort" type="checkbox" checked="checked" onclick="on_check_autosort()"><label for="m_autosort">Automatic sorting</label></span><br><span style="white-space:nowrap"><input id="m_startupxml" type="checkbox" checked="checked" onclick="on_check_startupxml()"><label for="m_startupxml">Use the first embedded xml file as startup xml file</label></span><br><span style="white-space:nowrap"><input id="m_encrypt" type="checkbox" onclick="on_check_encrypt()"><label for="m_encrypt">Encrypted all embedded files</label></span><br></div></td></tr></table></td><td></td><td style="margin:0;padding:0;vertical-align:top;padding:0;padding-left:4px"><table style="margin:0;padding:0" cellspacing="0"><tr><td style="margin:0;padding:0"><input style="width:100%;margin-top:0" type="button" value="Add Files" onclick="on_add_files()"><br><input style="width:100%" type="button" value="Add Folder" onclick="on_add_folder()"><br><input style="width:100%" type="button" value="Remove" onclick="on_remove()"><br><input style="width:100%" type="button" value="Remove All" onclick="on_remove_all()"><br><hr><input id="m_moveup" style="width:100%" type="button" value="Move Up" disabled="disabled" onclick="on_move_up()"><br><input id="m_movedn" style="width:100%" type="button" value="Move Down" disabled="disabled" onclick="on_move_down()"><br></td></tr></table></td></tr></table></div><div style="display:table-row; height:0; xbackground-color:#FFFF77" data-modaldragging="true"><div style="margin:20px"><div style="text-align:right" data-modaldragging="true"><button onclick="top.close_modal_window(0)" style="width:150px">Close</button></div></div></div></div></body></html><script>function ID(e){return document.getElementById(e)}function gui_iframe_close_callback(){var e=m_embeddedfiles;return m_embeddedfiles=null,e}function main(e){m_embeddedfiles=e,ID("m_autosort").checked=m_embeddedfiles.opt_autosort,ID("m_moveup").disabled=m_embeddedfiles.opt_autosort,ID("m_movedn").disabled=m_embeddedfiles.opt_autosort,ID("m_startupxml").checked=m_embeddedfiles.opt_startupxml,ID("m_encrypt").checked=m_embeddedfiles.opt_encryptall,data_update_filelist_gui()}function data_add_file(e,t){var n=m_embeddedfiles.files,r=n.length,i;for(i=0;i<r;i++)if(n[i].filepath==e)return;var s=new m_embeddedfiles.embeddedfile;s.filepath=e;var o=m_embeddedfiles.basepath;o==null&&(m_embeddedfiles.basepath=o=path.dirname(s.filepath)+path.sep);var u=path.relative(o,s.filepath);s.filepath_rel=u,s.size=t,s.type=detect_filetype(u);if(s.type>=4||u=="tour.swf"||u.indexOf("mobile_")>=0||u.indexOf("tablet_")>=0)s.embed=!1;n.push(s)}function format_filesize(e){return e<1024?e+" Byte":e<1048576?(e/1024).toFixed(2)+" KB":(e/1048576).toFixed(2)+" MB"}function detect_filetype(e){var t=path.extname(e).toLowerCase();switch(t){case".xml":return 0;case".png":case".gif":return 2;case".jpg":case".jpeg":return 3;case".swf":return 1;default:return 4}}function detect_cubeface_side(e){return e.indexOf("_l")>0?0:e.indexOf("_f")>0?1:e.indexOf("_r")>0?2:e.indexOf("_b")>0?3:e.indexOf("_u")>0||e.indexOf("_t")>0?4:e.indexOf("_d")>0?5:-1}function data_sort_compare(e,t){var n=e.embed,r=t.embed;if(m_embeddedfiles.startupxml==e.filepath)return-1;if(m_embeddedfiles.startupxml==t.filepath)return 1;if(n&&!r)return-1;if(!n&&r)return 1;var i=e.type,s=t.type,o=e.filepath_rel.toLowerCase(),u=t.filepath_rel.toLowerCase(),a=o.lastIndexOf(path.sep),f=u.lastIndexOf(path.sep);if(i==s){if(i==3){var l=o.indexOf("preview")>=0||o.indexOf("thumb")>=0,c=u.indexOf("preview")>=0||u.indexOf("thumb")>=0;if(l&&!c)return-1;if(!l&&c)return 1;var h=!1;if(a==f)if(a>0){var p=o.slice(0,a),d=u.slice(0,f);p==d&&(h=!0)}else h=!0;if(h){var v=detect_cubeface_side(o),m=detect_cubeface_side(u);if(v>=0&&m<0)return 1;if(v<0&&m>=0)return-1;if(v>=0&&m>=0){var g=[1,0,2,5,3,4],y=g[v],b=g[m];if(y<b)return-1;if(y>b)return 1}}}}else{if(i<s)return-1;if(i>s)return 1}return a>0&&f<0?1:a<0&&f>0?-1:o<u?-1:o>u?1:0}function data_sort_filelist(){m_embfiles_listbox&&m_embeddedfiles&&m_embeddedfiles.opt_autosort&&m_embeddedfiles.files&&m_embeddedfiles.files.sort(data_sort_compare)}function data_check_startupxml(){if(m_embeddedfiles.startupxml==null&&m_embeddedfiles.opt_startupxml){var e=m_embeddedfiles.files[0];e&&e.type==0&&(m_embeddedfiles.startupxml=e.filepath)}}function data_update_filelist_gui(e){if(m_embfiles_listbox&&m_embeddedfiles&&m_embeddedfiles.files){var t=m_embeddedfiles.files,n=m_embeddedfiles.startupxml,r,i=t.length,s=0,o=0,u=e!==2;u&&m_embfiles_listbox.removeAll();for(r=0;r<i;r++){var a=t[r],f=a.embed,l=filetype_to_txt[a.type],c=!1;r==0&&n==a.filepath&&(c=!0,l="Startup XML"),f&&(s++,o+=a.size),u&&m_embfiles_listbox.addTextRow([f?s:"",a.filepath_rel,f?l:"skipped",format_filesize(a.size)],c?{color:"rgb(0,100,200)"}:f?null:{color:"gray"})}ID("m_basepath").value=m_embeddedfiles.basepath,m_embeddedfiles.totalinfo=ID("m_totalinfo").innerHTML=s+" Files - "+format_filesize(o),m_embfiles_listbox.selectedIndex=-1}}function add_files_callback(e,t,n){if(t){var r,i=t.length;i>0&&(m_embeddedfiles.ui_last_add_folder=path.dirname(t[0].path)+path.sep);for(r=0;r<i;r++){var s=t[r];data_add_file(s.path,s.size)}data_sort_filelist(),data_check_startupxml(),data_update_filelist_gui()}}function add_folder_callback(e,t){var n=t.length,r;n>0&&(m_embeddedfiles.ui_last_add_folder=t[0].path+path.sep);for(r=0;r<n;r++){var i=t[r],s=fs.statSync(i.path);s&&(s.isDirectory()?top.ksystem.walkDirASync(i.path,function(e,t){if(!e&&m_embfiles_listbox&&m_embeddedfiles){var n=t.length,r;for(r=0;r<n;r++)data_add_file(t[r].path,t[r].size);data_sort_filelist(),data_check_startupxml(),data_update_filelist_gui()}}):data_add_file(i.path,i.size))}data_sort_filelist(),data_check_startupxml(),data_update_filelist_gui()}function on_add_files(){var e=m_embeddedfiles?m_embeddedfiles.ui_last_add_folder:null;top.gui_dialogs.openFile(add_files_callback,e,!0,".swf,.xml,.png,.gif,.jpg,.jpeg")}function on_add_folder(){var e=m_embeddedfiles?m_embeddedfiles.ui_last_add_folder:null;top.gui_dialogs.openDir(add_folder_callback,e)}function on_remove(){var e,t=m_embfiles_listbox.options,n=m_embeddedfiles.files,r=m_embeddedfiles.startupxml,i=1;for(e=t.length-1;e>=0;e--)t[e].selected&&(m_embfiles_listbox.removeRow(e),n.splice(e,1).filepath==r&&(m_embeddedfiles.startupxml=null,i=2));data_update_filelist_gui(i)}function on_remove_all(){m_embeddedfiles.files=[],m_embeddedfiles.basepath=null,m_embeddedfiles.startupxml=null,data_update_filelist_gui()}function on_move_up(){var e=m_embfiles_listbox.options,t=m_embeddedfiles.startupxml,n=m_embeddedfiles.files,r=n.length,i,s,o=new Array(r);for(i=0;i<r;i++)o[i]=e[i].selected&&t!=n[i].filepath;var u=t!=null?1:0;for(i=1,s=0;i<r;i++){var a=n[i],f=o[i];if(f&&i>u){s=i-1;var l=n[s],c=o[s];c==0&&(n[s]=a,n[i]=l,o[s]=f,o[i]=c)}}data_update_filelist_gui();var h=-1;for(i=0;i<r;i++)o[i]&&(h<0&&(h=i),m_embfiles_listbox.setRowSelect(i,!0));h>=0&&m_embfiles_listbox.scrollToIndex(h)}function on_move_down(){var e=m_embfiles_listbox.options,t=m_embeddedfiles.startupxml,n=m_embeddedfiles.files,r=n.length,i,s,o=new Array(r);for(i=0;i<r;i++)o[i]=e[i].selected&&t!=n[i].filepath;var u=t!=null?1:0;for(i=r-1;i>=u;i--){var a=n[i],f=o[i];if(f&&i<r-1){s=i+1;var l=n[s],c=o[s];c==0&&(n[s]=a,n[i]=l,o[s]=f,o[i]=c)}}data_update_filelist_gui();var h=-1;for(i=0;i<r;i++)o[i]&&(i>h&&(h=i),m_embfiles_listbox.setRowSelect(i,!0));h>=0&&m_embfiles_listbox.scrollToIndex(h)}function on_browse_basepath(){top.gui_dialogs.openDir(on_browse_basepath_done,m_embeddedfiles.basepath)}function on_browse_basepath_done(e,t){newbasepath=e+path.sep;if(newbasepath!=m_embeddedfiles.basepath||t===!0){m_embeddedfiles.basepath=newbasepath;var n=m_embeddedfiles.files,r=n.length,i;for(i=0;i<r;i++){var s=n[i];s.filepath_rel=path.relative(newbasepath,s.filepath)}data_sort_filelist(),data_update_filelist_gui()}}function on_check_autosort(){var e=ID("m_autosort").checked;m_embeddedfiles.opt_autosort=e,ID("m_moveup").disabled=e,ID("m_movedn").disabled=e,e&&(data_sort_filelist(),data_update_filelist_gui())}function on_check_startupxml(){var e=ID("m_startupxml").checked;m_embeddedfiles.opt_startupxml=e}function on_check_encrypt(){var e=ID("m_encrypt").checked;m_embeddedfiles.opt_encryptall=e}var path=top.require("path"),fs=top.require("fs");top.gui_style_do_system_fixes(document),top.gui_block_external_dragging(document);var m_embfiles_listbox=top.gui_listbox(ID("m_embfiles"),[{name:"Order",width:35,minwidth:10,align:"left"},{name:"Filename",width:"300%",minwidth:100,align:"left"},{name:"Type",width:100,minwidth:50,align:"left"},{name:"Filesize",width:100,minwidth:50,align:"right"}],{enableFileDropping:!0}),m_embeddedfiles=null,filetype_to_txt=["XML","SWF","Image","Jpeg",""];m_embfiles_listbox.onDroppedFiles=function(e){add_folder_callback(null,e)},m_embfiles_listbox.onContextMenu=function(e,t){var n=m_embfiles_listbox.options,r=m_embeddedfiles.files,i,s=r.length,o=0,u=0;for(i=0;i<s;i++)n[i].selected&&(o++,r[i].embed||u++);if(o>0){var a=o==1||o==u?r[e].embed:!0,f=o==1?"":"s",l=top.gui_contextmenu_create();if(o==1&&r[e].type==0){var c=m_embeddedfiles.startupxml==r[e].filepath;l.addItem({type:"checkbox",label:"Set as startup xml file",checked:c,click:function(){if(c)m_embeddedfiles.startupxml=null,ID("m_startupxml").checked=!1,m_embeddedfiles.opt_startupxml=!1,data_update_filelist_gui();else{var t=m_embeddedfiles.files,n=t.splice(e,1)[0];t.splice(0,0,n),m_embeddedfiles.startupxml=n.filepath,ID("m_startupxml").checked=!1,m_embeddedfiles.opt_startupxml=!1,on_browse_basepath_done(path.dirname(n.filepath),!0)}}})}l.addItem({type:"normal",label:"Remove file"+f,click:function(){on_remove()}}),l.addItem({type:"checkbox",label:"Skip file"+f,checked:!a,click:function(){var e,t=m_embfiles_listbox.options,n=m_embeddedfiles.files,r=m_embeddedfiles.startupxml;for(e=t.length-1;e>=0;e--)t[e].selected&&n[e].filepath!=r&&(n[e].embed=!a);data_update_filelist_gui()}}),l.popup(t)}}</script>