function gui_listbox(e,t,n){function m(){var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);var n=e.offsetWidth;t.style.overflow="scroll";var r=e.offsetWidth;return n==r&&(r=t.clientWidth),document.body.removeChild(t),n-r}function g(e){e.onmousedown=function(t){if(t.button==0){var n=e.dataset.rowindex|0;s.selectRow(n,!0,t.ctrlKey,t.shiftKey)}},e.oncontextmenu=function(t){i=e.dataset.rowindex|0,s.options[i].selected||s.selectRow(i,!0,t.ctrlKey,t.shiftKey),s.onContextMenu!=null&&s.onContextMenu(i,t)}}function y(){function L(){var e,t;t=h.length-1;for(e=0;e<t;e++){var n=window.getComputedStyle(h[e]).width;h[e].style.width=n,v[e].style.width=n}}function A(t,n,r){function u(e){var t=e.screenX-s,i=o+t;n.style.width=i+"px",r.style.width=i+"px",M()}function a(t){i&&(e.ownerDocument.documentElement.removeChild(i),i=null),e.ownerDocument.documentElement.removeEventListener("mousemove",u,!1),e.ownerDocument.documentElement.removeEventListener("mouseup",a,!1)}var i=null,s=0,o=0;t.onmousedown=function(t){s=t.screenX,L();var r=window.getComputedStyle(n);o=parseInt(r.width),i=document.createElement("div"),i.style.position="absolute",i.style.top=0,i.style.left=0,i.style.width="100%",i.style.height="100%",i.style.cursor=ksystem.isWindows?"e-resize":"col-resize",i.style.zIndex=1e4,i.onselectstart=function(){return!1},e.ownerDocument.documentElement.appendChild(i),e.ownerDocument.documentElement.addEventListener("mousemove",u,!1),e.ownerDocument.documentElement.addEventListener("mouseup",a,!1)}}function M(){for(var e=0,t=0;e<h.length-1;e++){t+=h[e].offsetWidth;var n=O[e];n||(n=document.createElement("div"),n.className="gui_listbox_colresizer",n.style.cursor=ksystem.isWindows?"e-resize":"col-resize",O[e]=n),n.style.left=t-4+"px",A(n,h[e],v[e]),l.appendChild(n)}}o=document.createElement("div"),o.className="gui_listbox_control",o.style.position="relative",o.style.width="100%",o.style.height="100%",o.tabIndex="0",u=document.createElement("div"),u.className="gui_listbox_dropinfo",u.style.display="none",dropinfo_text=document.createElement("div"),dropinfo_text.className="gui_listbox_dropinfo_text",u.appendChild(dropinfo_text),a=document.createElement("div"),f=document.createElement("div"),l=document.createElement("table"),c=document.createElement("tbody"),h=[],p=document.createElement("table"),d=document.createElement("tbody"),v=[],a.className="gui_listbox_scroller",f.className="gui_listbox_header",f.style.width="calc(100% - "+m()+"px)",a.addEventListener("scroll",function(){l.style.left=0-a.scrollLeft+"px"},!0),l.setAttribute("cellspacing","0"),l.setAttribute("cellpadding","0"),l.className="gui_listbox_table",l.appendChild(c),f.appendChild(l),p.setAttribute("cellspacing","0"),p.setAttribute("cellpadding","0"),p.className="gui_listbox_table gui_listbox_table_list";var i=t.length,s,g=l.insertRow(),y=p.insertRow(),b=-1;for(s=0;s<i+r;s++){var w=g.insertCell(),E=y.insertCell();if(s<i){var S=document.createTextNode(t[s].name),x=document.createTextNode(t[s].name),T=t[s].width;if((""+T).indexOf("%")>0)N=T;else{var N="";T<=0||s==i-1&&b<0?(b=s,N="100%"):N=T+"px"}w.style.width=N,E.style.width=N;var C=t[s].align?t[s].align:n&&n.align?n.align:"left",k=t[s].valign?t[s].valign:n&&n.valign?n.valign:"middle";w.style.textAlign=C,E.style.textAlign=C,w.appendChild(S),E.appendChild(x)}else w.style.width="50%",E.style.width="50%";g.appendChild(w),y.appendChild(E),h.push(w),v.push(E)}c.appendChild(g),d.appendChild(y),p.appendChild(d),o.appendChild(u),o.appendChild(a),o.appendChild(f),a.appendChild(p),e.appendChild(o),new ResizeSensor(o,function(){f.style.width="calc(100% - "+m()+"px)",M()}),f.style.height=h[0].offsetHeight+"px";var O=new Array(h.length);M()}function b(){function r(t){t.preventDefault(),t.stopPropagation(),n==0&&(n=!0,u.style.display="",e.style.outline="auto 5px Highlight")}function i(t){t.preventDefault(),t.stopPropagation(),n==1&&(n=!1,s.options.length>0&&(u.style.display="none"),e.style.outline="")}var t=o,n=!1;s.dropable=!0,t.ondragenter=r,u.ondragleave=i,t.ondrop=function(e){return i(e),e.preventDefault(),s.onDroppedFiles!=null&&s.onDroppedFiles(e.dataTransfer.files),!1}}var r=t&&t.length>1,s={dom:e,columns:t,selectedIndex:-1,disabled:!1,dropable:!1,onDroppedFiles:null,onContextMenu:null,options:[]};n&&n.nofillcol===!0&&(r=0);var o=null,u=null,a=null,f=null,l=null,c=null,h=[],p=null,d=null,v=[];return s.addTextRow=function(e,o,u){var a=p.insertRow();if(o)for(var f in o)a.style[f]=o[f];var l=s.options.length;a.dataset.rowindex=l,g(a);var c=t.length,h=e.length;u&&u.length>0&&(c=u.length);for(i=0;i<c+r;i++){var v=a.insertCell();u&&!isNaN(u[i])&&(v.colSpan=u[i]);if(i<c){var m=t[i].align?t[i].align:n&&n.align?n.align:"left",y=t[i].valign?t[i].valign:n&&n.valign?n.valign:"middle";v.style.textAlign=m}var b=document.createTextNode(i<h?e[i]:"");v.appendChild(b),a.appendChild(v)}return d.appendChild(a),s.options.push({text:e.join("|"),selected:!1}),s.updateControl(),l},s.setCellText=function(e,t,n){if(e>=0&&e<s.options.length){var r=p.rows[e+1],i=r.cells[t];i&&(i.innerHTML=n,s.options[e].text=n)}},s.removeRow=function(e){if(e>=0&&e<s.options.length){p.deleteRow(e+1),s.options.splice(e,1),e==s.selectedIndex&&(s.selectedIndex=-1);var t=s.options.length,n=null;while(e<t)n=p.rows[e+1],n.dataset.rowindex=e,e++;s.updateControl()}},s.setRowSelect=function(e,t){if(e>=0&&e<s.options.length){var n=p.rows[e+1];if(!n)return;n.className=t?"gui_listbox_selected":"",s.options[e].selected=t,t?s.selectedIndex==-1&&(s.selectedIndex=e):s.selectedIndex==e&&(s.selectedIndex=-1)}},s.selectRow=function(e,t,n,r){function i(){var e=s.options,t=e.length,n;for(n=0;n<t;n++)if(e[n].selected){var r=p.rows[n+1];r&&(r.className=""),e[n].selected=!1}s.selectedIndex=-1}if(e>=0&&e<s.options.length){var o=s.selectedIndex,u=p.rows[e+1];if(!u)return;o<0&&(n||r)&&(n=!1,r=!1);if(n==0&&r==0){i();if(t==0||o!=e)u.className="gui_listbox_selected",s.options[e].selected=!0,s.selectedIndex=e}else if(n)s.options[e].selected?(u.className="",s.options[e].selected=!1):(u.className="gui_listbox_selected",s.options[e].selected=!0);else if(r){i();var a=o<e?o:e,f=o<e?e:o;for(e=a;e<=f;e++){var u=p.rows[e+1];u.className="gui_listbox_selected",s.options[e].selected=!0}s.selectedIndex=o}}else e<0&&i()},s.removeAll=function(){var t=p.rows.length,n;for(n=t-1;n>0;n--)p.deleteRow(n);s.options=[],e.options=s.options,s.updateControl()},s.enable=function(){o.style.pointerEvents="auto",o.style.opacity=1,o.style.color="",o.tabIndex="0"},s.disable=function(){o.style.pointerEvents="none",o.style.opacity=.6,o.style.color="gray",o.tabIndex="-1"},s.scrollToIndex=function(e){if(e>=0&&e<s.options.length){var t=p.rows[0],n=p.rows[e+1],r=-(t.offsetTop+t.offsetHeight)+n.offsetTop,i=r+n.offsetHeight+1;r<a.scrollTop?a.scrollTop=r:i>=a.scrollTop+a.offsetHeight&&(a.scrollTop=i-a.offsetHeight+(t.offsetTop+t.offsetHeight))}},s.focus=function(){o.focus()},s.updateControl=function(){s.dropable&&(s.options.length==0?u.style.display="":u.style.display="none")},e.listbox=s,e.add=function(e){e&&e.text&&s.addTextRow([e.text])},e.remove=function(e){s.removeRow(e)},e.removeAll=s.removeAll,e.sort=function(e,t){s.sortRows(e,t)},e.options=s.options,e.__defineGetter__("selectedIndex",function(){return s.selectedIndex}),e.__defineSetter__("selectedIndex",function(e){s.selectRow(e,!1,!1,!1)}),e.__defineGetter__("disabled",function(){return s.disabled}),e.__defineSetter__("disabled",function(e){e?s.disable():s.enable()}),y(),n&&n.enableFileDropping&&b(),s.updateControl(),s}