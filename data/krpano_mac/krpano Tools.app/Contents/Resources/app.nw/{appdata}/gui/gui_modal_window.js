function gui_disable_everything(){var e=["a","BODY","button","frame","iframe","img","input","object","select","textArea"],t,n;for(t=0;t<e.length;t++){var r=document.getElementsByTagName(e[t]);if(r)for(n=0;n<r.length;n++){var i=r[n];gui_disabled_backup.push({element:i,disabled:i.disabled,tabIndex:i.tabIndex}),i.tabIndex!=-1&&(i.tabIndex=-1)}}}function gui_reenable_everything(){var e;for(e=0;e<gui_disabled_backup.length;e++){var t=gui_disabled_backup[e];t.tabIndex!=-1&&(t.element.tabIndex=t.tabIndex)}gui_disabled_backup=[]}function gui_modal_window(e,t,n){function g(e){if(m){var t=top.ksystem.getZoomFactor(),n=window.innerWidth,r=window.innerHeight,o=m[0],a=m[1],f=e.screenX,l=e.screenY,c=f-m[2],h=l-m[3];o+=c/t,a+=h/t,o+i>n-gui_modal_border&&(o=n-gui_modal_border-i),a+s>r-gui_modal_border&&(a=r-gui_modal_border-s),o<=gui_modal_border&&(o=gui_modal_border),a<=gui_modal_border&&(a=gui_modal_border),v[0]=o,v[1]=a,m[0]=o,m[1]=a,m[2]=f,m[3]=l,gui_modal_rendermode==1?(t!=1?(o=(o*t|0)/t,a=(a*t|0)/t):(o|=0,a|=0),u.style["-webkit-transform"]="translate3D("+o+"px,"+a+"px,0px)"):(u.style.left=(o|0)+"px",u.style.top=(a|0)+"px")}}function y(e){var t=u.contentDocument.body,n=u.contentWindow;a&&u.contentDocument.addEventListener("keydown",gui_modal_window_handle_esc_key,!0),f==0&&t.addEventListener("mousedown",function(e){if(e.target&&(e.target.nodeName=="BODY"||e.target.dataset.modaldragging)){m=[v[0],v[1],e.screenX,e.screenY],n.addEventListener("mousemove",g,!1);function t(e){m=null,n.removeEventListener("mousemove",g,!1)}n.addEventListener("mouseup",t,!0)}},!1);if(f==0){i=t.scrollWidth+1,s=t.scrollHeight+1,u.style.width=i+"px",u.style.height=s+"px";var l=(top.innerWidth>>1)-(i>>1),c=(top.innerHeight>>1)-(s>>1);v[0]=l,v[1]=c;if(gui_modal_rendermode==1){var d=top.ksystem.getZoomFactor();d!=1?(l=(l*d|0)/d,c=(c*d|0)/d):(l|=0,c|=0),u.style["-webkit-transform"]="translate3D("+l+"px,"+c+"px,0px)"}else u.style.left=(l|0)+"px",u.style.top=(c|0)+"px"}else u.style.width="100%",u.style.height="100%",u.style.left=0,u.style.top=0;n.main&&n.main(p),u.style.display="",gui_settings_bg_blur&&h&&(document.getElementById("mainframe").style["-webkit-filter"]="blur(2px)"),gui_settings_fading?tween_style(o,"opacity",1,.25,function(){r.__krpgui_modalwnd.ready=!0}):(o.style.visibility="visible",r.__krpgui_modalwnd.ready=!0),n.focus()}var r=gui_get_global();if(r.__krpgui_modalwnd&&n!==!0){console.log("have already an modal window");return}r.__krpgui_modalwnd={ready:!1,bglayer:null,iframe:null,pos:[0,0],fs:!1,options:null},gui_disable_everything();var i=100,s=100,o=document.createElement("div"),u=document.createElement("iframe"),a=!0,f=!1,l=0,c=0,h=!0,p=null,d=!1;t?(t.width!==undefined&&(l=parseInt(t.width)),t.height!==undefined&&(c=parseInt(t.height)),t.fs!==undefined&&(f=t.fs),t.esckey!==undefined&&(a=t.esckey),t.blur!==undefined&&(h=t.blur),t.args!==undefined&&(p=t.args),t.resizeable!==undefined&&(d=t.resizeable)):t={},r.__krpgui_modalwnd.fs=f,r.__krpgui_modalwnd.options=t,a&&document.addEventListener("keydown",gui_modal_window_handle_esc_key,!0),top.addEventListener("resize",gui_modal_window_onresize,!1),(l|0)<=0&&(l=500),o.style.position="absolute",o.style.zIndex=1e4,o.style.width="100%",o.style.height="100%",o.style.left="0px",o.style.top="0px",o.style.backgroundColor="rgba(0,0,0,0.5)",gui_settings_fading?o.style.opacity=0:o.style.visibility="hidden",o.style.overflow="auto",o.onselectstart=function(){return!1},gui_modal_rendermode==1&&(o.style["-webkit-transform"]="translateZ(0)"),u.style.position="absolute",u.style.width=f?"100%":l+"px",c>10&&(u.style.height=c+"px"),u.style.border="0px",u.style.boxShadow="0 0 16px rgba(0,0,0,0.7)",gui_modal_rendermode==1&&(u.style["-webkit-transform"]="translateZ(0)"),t&&t.bgcolor!==undefined&&(u.style.backgroundColor=t.bgcolor),d&&(u.style.resize="both");var v=r.__krpgui_modalwnd.pos,m=null;u.onload=y,u.style.display="hidden",u.src=e,r.__krpgui_modalwnd.bglayer=o,r.__krpgui_modalwnd.iframe=u,document.body.appendChild(o),o.appendChild(u)}function gui_modal_window_handle_esc_key(e){var t=e.keyCode;t==27&&(e.preventDefault(),close_modal_window(2))}function gui_modal_window_onresize(e){var t=gui_get_global();if(t.__krpgui_modalwnd){var n=t.__krpgui_modalwnd.bglayer,r=t.__krpgui_modalwnd.iframe,i=t.__krpgui_modalwnd.pos,s=i[0],o=i[1],u=window.innerWidth,a=window.innerHeight,f=top.gui_window_state.lastsize,l=top.gui_window_state.currentsize;if(!r||!r.contentDocument)return;var c=r.contentDocument.body;if(!c)return;contentwidth=c.scrollWidth,contentheight=c.scrollHeight,f&&l&&(s+=(l.w-f.w)/2,o+=(l.h-f.h)/2);var h=t.__krpgui_modalwnd.fs?0:gui_modal_border;s+contentwidth>u-h&&(s=u-h-contentwidth),o+contentheight>a-h&&(o=a-h-contentheight),s<=h&&(s=h),o<=h&&(o=h),i[0]=s,i[1]=o;if(gui_modal_rendermode==1){var p=top.ksystem.getZoomFactor();p!=1?(s=(s*p|0)/p,o=(o*p|0)/p):(s|=0,o|=0),r.style["-webkit-transform"]="translate3D("+s+"px,"+o+"px,0px)"}else r.style.left=(s|0)+"px",r.style.top=(o|0)+"px";n.style.overflow="hidden",n.scrollWidth,n.style.overflow="auto"}}function close_modal_window(e,t){e|=0;var n=gui_get_global();if(!n.__krpgui_modalwnd||n.__krpgui_modalwnd.ready!==!0)return;var r=n.__krpgui_modalwnd.bglayer;if(r){var i,s=n.__krpgui_modalwnd.options.onclosed,o=n.__krpgui_modalwnd.iframe;o.contentWindow.gui_iframe_close_callback&&(i=o.contentWindow.gui_iframe_close_callback(e)),document.removeEventListener("keydown",gui_modal_window_handle_esc_key,!0),o.contentDocument.removeEventListener("keydown",gui_modal_window_handle_esc_key,!0),top.removeEventListener("resize",gui_modal_window_onresize,!1),n.__krpgui_modalwnd=null,delete n.__krpgui_modalwnd,gui_settings_bg_blur&&(document.getElementById("mainframe").style["-webkit-filter"]=null),s&&s(i),gui_settings_fading?tween_style(r,"opacity",0,.25,function(){document.body.removeChild(r),gui_reenable_everything(),t!==undefined&&t()}):(document.body.removeChild(r),gui_reenable_everything(),t!==undefined&&t())}}var gui_modal_rendermode=1,gui_settings_bg_blur=!1,gui_settings_fading=!0,gui_modal_border=4,gui_disabled_backup=[]